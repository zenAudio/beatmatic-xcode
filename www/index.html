<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name = "format-detection" content = "telephone=no"/>
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width;" />
        <link rel="stylesheet" type="text/css" href="css/less/colours.css" />
        <link rel="stylesheet" type="text/css" href="css/less/tiles.css" />
        <link rel="stylesheet" type="text/css" href="css/main.css" />
        
        <title>BEATmatic</title>
    </head>
    <body>
        <div id="ui" class="ui">
            <input type="submit" onclick="playTestTone()" value="Play test tone" />
            <input type="submit" onclick="audition('kick drum')" value="Kick" />
            <input type="submit" onclick="audition('snare drum')" value="Snare" />
            <input type="submit" onclick="audition('hi-hat')" value="Hi-Hat" />
            <input type="submit" onclick="play()" value="Play" />
            <input type="submit" onclick="stop()" value="Stop" />
            <input type="submit" onclick="toggleLoop('synth', 0)" value="Synth 1" />
            <input type="submit" onclick="toggleLoop('synth', 1)" value="Synth 2" />
            <input type="submit" onclick="toggleLoop('melodic', 6)" value="Melodic 6" />
            <input type="submit" onclick="toggleLoop('melodic', 7)" value="Melodic 7" />
        </div>
        <script type="text/javascript" src="cordova-2.0.0.js"></script>
        <script type="text/javascript" src="js/jquery-1.8.0.js"></script>
        <script type="text/javascript" src="js/jquery.touchSwipe.js"></script>
        <script type="text/javascript" src="coffee/ui.js"></script>
        <script type="text/javascript" src="coffee/diracplayer.js"></script>
        <script type="text/javascript" src="coffee/sequencer.js"></script>        
        <script type="text/javascript" src="coffee/record.js"></script>
        <script type="text/javascript" src="coffee/play.js"></script>
        <script type="text/javascript" src="coffee/dj.js"></script>
        <script type="text/javascript" src="coffee/audioengine.js"></script>
        <script src="http://debug.phonegap.com/target/target-script-min.js#beatmatic"></script>
        <script type="text/javascript">
            document.addEventListener("deviceready", onDeviceReady, false);
            
            function onDeviceReady() {
                console.log("MPD:HTML:onDeviceReady");
                BEATmatic.audioEngine.init("sounds/drummachine/defpreset/preset.json", "sounds/looper/defpreset/preset.json");
                console.log("MPD:HTML:onDeviceReady: initialized drum preset.");
                var json = JSON.stringify({
                                          "bpm": 120,
                                          "tracks": [
                                                     {
                                                     "name": "kick drum",
                                                     "score": [100,0,0,0,  100,0,0,0,  100,0,0,0,  100,0,100,0]
                                                     },
                                                     {
                                                     "name": "snare drum",
                                                     "score": [0,0,0,0,    100,0,0,0,   0,0,0,0,   100,0,0,0]
                                                     },
                                                     {
                                                     "name": "hi-hat",
                                                     "score": [0,0,100,0,  0,0,100,0,  0,0,100,0,   0,0,100,0]
                                                     }
                                                     ]});
                console.log("MPD:HTML:onDeviceReady: about to set drum pattern to " + json);
                BEATmatic.audioEngine.setDrumPattern(json);
                console.log("MPD:HTML:onDeviceReady:set drum pattern.");
            }
            
            function playTestTone() {
                try {
//                    console.log(BEATmatic.audioEngine);
                    BEATmatic.audioEngine.playTestTone();
                } catch (e) {
                    console.log(e.message);
                }
            }
            function audition(soundName) {
                try {
                    console.log("MPD: HTML: auditioning sound " + soundName);
                    BEATmatic.audioEngine.auditionDrum(soundName);
                } catch (e) {
                    console.log(e.message);
                }
            }
            function play() {
                try {
                    console.log("MPD: HTML: pressed play");
                    BEATmatic.audioEngine.play();
                } catch (e) {
                    console.log(e.message);
                }
            }
            function stop() {
                try {
                    console.log("MPD: HTML: pressed stop");
                    BEATmatic.audioEngine.stop();
                } catch (e) {
                    console.log(e.message);
                }
            }
            function toggleLoop(group, ix) {
                try {
                    console.log("MPD: HTML: pressed toggle loop " + group + ", " + ix);
                    BEATmatic.audioEngine.toggleLoop(group, ix);
                } catch (e) {
                    console.log(e.message);
                }
            }
        </script>
    </body>
</html>
